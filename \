resource "aws_instance" "go-server" {
  ami                         = var.ami
  instance_type               = var.instance_type
  associate_public_ip_address = true
  subnet_id                   = aws_subnet.public_subnets[0].id
  user_data                   = <<-EOF
          #!/bin/bash
          sudo apt update -y
          sudo apt-get install -y git curl

          # Install Go.
          wget https://golang.org/dl/go1.23.1.linux-amd64.tar.gz
          sudo tar -C /usr/local -xzf go1.23.1.linux-amd64.tar.gz
          echo "export PATH=$PATH:/usr/local/go/bin" >> ~/.profile
        
          git clone https://github.com/Akhilbisht798/cloud-code-editor.git /home/ubuntu/
          cd /home/ubuntu/cloud-code-editor/go-server
          
          /usr/local/go/bin/go build -o server .
          nohup ./server &
          EOF
  tags = {
    Name = "Go-Server"
  }
}
